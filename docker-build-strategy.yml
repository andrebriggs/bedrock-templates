parameters:
- name: ImageName # name of the parameter; required
  type: string # data type of the parameter; required
- name: ImageTag
  type: string
- name: BuildArgVariableGroup
  type: string
  default: ''
- name: BuildArgs
  type: object
  default: []
- name: imageRepoType
  type: string
  default: ACR
# variables:
#   # ${{ if ne(parameters.BuildArgVariableGroup, '') }}:
#   group: ${{ parameters.BuildArgVariableGroup }}

steps:
- script: |-
    echo ${{ parameters.ImageName }}
    echo ${{ parameters.ImageTag }}
    echo BuildArgs: "${{join(';',parameters.BuildArgs.*)}}"
    echo $(System.DefaultWorkingDirectory)
    cd $(System.DefaultWorkingDirectory)
    ls -la
    sudo chmod +x build-strategy.sh
  displayName: Debugging messages
- task: Bash@3
  inputs:
    # targetType: 'filePath'
    ${{ if eq(parameters.imageRepoType, 'ACR') }}:
      filePath: ACR-build-strategy.sh
    ${{ if eq(parameters.imageRepoType, 'DockerHub') }}:
      filePath: DockerHub-build-strategy.sh
  env:
    IMAGE_TAG: ${{ parameters.ImageTag }}
    BUILD_REPO_NAME: ${{ parameters.ImageName }}
    BUILD_ARG_YAML: ${{join(';',parameters.BuildArgs.*)}}
    ${{ each item in parameters.BuildArgs.* }}: # We want the bash script to have access to the var values
      ${{ item }}: ${{ format('${0}', item) }}
  displayName: Execute Docker Image Build
# - ${{ if ne(parameters.BuildArgVariableGroup, '') }}:
#   - script: |-
#       echo BuildArgVariableGroup: ${{ parameters.BuildArgVariableGroup }}
# - ${{ each item in parameters.BuildArgs.* }}:
#   - script: echo ${{ item }}
